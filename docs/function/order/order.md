# 订单管理

::: tip
- 订单管理，整个ERP核心功能。业务操作是由员工代客户下单。可普通订单，亦可飞单。
- 订单依赖：[客户管理](../basic/customer)、[字典管理（订单类型）](../basic/dict)、[商品管理](../product/)
- 依赖订单功能的有：[打印管理](../print/)、[财务管理](../finance/)、[售后管理](../aftersale/)、[库存管理](../stock/)
:::

::: warning
- 订单管理，增加了几个键盘操作。
- 在任意页面，通过 `CTRL` + `D`，快速切换到订单管理，并且打开新增订单页。
- 在订单管理页面，通过 `CTRL` + `D`，快速切换打开新增订单页。
- 在订单新增页面，请善用Tab切换焦点。
- 订单新增页面，Real Price后按 `Enter` 回车，会自动增加一行。
:::

## 功能预览
![](/order/order.png)
- 列表，`搜索、列表、分页`，功能有：`新增`、`编辑`、`删除`、`Post`
- 搜索条件：订单编号是模糊匹配
- 列表中首列是展开标识。展开后，可以看到[订单列表-展开](#订单列表-展开)
- 订单状态请参考 [订单状态流转说明](#订单状态流转说明)
- **编辑**：编辑后订单状态不变。只有（`Created`、`Picking`、`Picked`、`Checked`）状态才可编辑。不可编辑时按钮不可点击
- **删除**：只有（`Created`）状态才可删除。订单从其他状态变回`Created`，需要的是对应的拣货单删除。
- **Post**：单个订单的Post操作。一般来说，订单的post是拣货单Post后批量处理的，很少有单独订单post的需要。
  - 只有（`Checked`）状态才可Post操作
  - 操作后，订单变成Posted状态，且对应的库存也扣除。

## 订单列表-展开
![](/order/order-expend.png)

## 新增订单-普通订单
![](/order/order-add-normal.png)
- 若选择的客户不能下飞单（无飞单账号），则页面表现如上，只有 `Order 1` 按钮。否则显示 `Order 1` 和 `Order 2` 两个按钮。参考 [飞单](#新增订单-飞单)
- 点击 `Order 1` 按钮，会增加一行商品信息，请参考[点击按钮后](#点击按钮后)。Product列是下拉框。可以下单的商品列表都会显示出来。
- 选择商品后，会根据客户的星级决定`Suggest Price`和`Real Price`，具体逻辑是：
  - 某客户的星级是1~5之间，可以参考 [新增客户](../basic/customer#新增客户)。对应此商品的Sell Price 1~5，可以参考 [新增商品](../product/product#新增商品-基本信息)
  - `Suggest Price` 不可更改。
  - `Real Price` 可以更改，但是不允许低于此商品限定当前星级的最低售价。

**比如，某订单有如下设定。如果客户星级是4，则:**
- `Suggest Price`和`Real Price`都默认:`200`
- `Real Price` 最低可调整到：`180`

|     |   Price 5  |   Price 4  |   Price 3  |   Price 2  |   Price 1  |
|---  |--- | --- | --- | --- | --- |
|  Sell   |  100   |  200   |  300   |  400   |  500   |
|  Limit   |  90   |  180   |  245   |  370   |  430   |


## 新增订单-飞单
#### 添加商品前
![](/order/order-add-fly.png)
- 若选择的客户可以下飞单（有飞单账号），则页面表现如上，显示 `Order 1` 和 `Order 2` 两个按钮。
- `Order 1` 和 `Order 2` 功能相同，但是会在各自的表格中添加一行。
- `Order 2` 为飞单的商品列表。
- **重要：** 新增订单时，如果Order 1 和 2 都有选择商品，会生成2个订单，一个是当前客户下单，一个是子客户下的飞单。
#### 点击按钮后
![](/order/order-add-all.png)
- `Order 1` 和 `Order 2`
- 每行红色按钮可以删除当前行
- Quality是购买的数量

## 修改订单
![](/order/order-edit.png)
- 新增订单和修改订单不同。新增时可以同时生成普通订单和飞单。而修改只能对其中一个订单进行修改。
- 修改时，不允许修改客户和订单类型。
- 其他同新增订单一样。

## 订单状态流转说明
- 订单状态目前设定10种，目前只用前三种：`Created`、`Pending`、`Posted`，如下图所示。
![](/order/order-status.png)

**目前在用**
|  订单状态  |   中文说明  |   操作或动作  |   此状态订单允许的操作  |   说明  |
| ---  | --- | --- | --- |   -  |
|  `Created`   |  已下单   |  创建订单后   |  编辑、删除  |   -  |
|  `Pending`   |  拣货中   |  交割时间后，自动变成Pending   |   编辑  |  系统控制从 Created 变成 Pending  |
|  `Posted`   |  Posted   |  1，【[拣货单](../print/pickup)】Post <br>2，订单单独Post  |   -  |   拣货单批量控制和订单自行Post  |

**预留**
|  订单状态  |   中文说明  |   操作或动作  |   此状态订单允许的操作  |   说明  |
| ---  | --- | --- | --- |   -  |
|  `Delivering`   |  配送中   |  （预留）  |  -   |  有司机端再说  |
|  `Complete`   |  已完成   |  （预留）   |   -  |  有司机端再说  |
|  `Sales Return`   |  退货   |  （预留）  |  -   |  有司机端再说 |
|  `Picked`   |  已拣货   |  （预留）   |  -  |   -  |
|  `Checked`   |  已核对   |  （预留）  |  -   |   -  |
|  `Rejected`   |  拒收   |  （预留）   |   -  |   -  |
|  `Canceled`   |  取消   |  （预留）   |   -  |   -  |


